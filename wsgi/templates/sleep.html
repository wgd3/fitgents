{% extends 'base.html' %}

{% block body %}

<div class="row">

	<div class="page-header">
		<h1>Sleep
			<a href="#" class="btn btn-default pull-right" data-toggle="modal" data-target="#modal_sleep">
				<span class="glyphicon glyphicon-plus"></span> Log New Data
			</a>
		</h1>
	</div>

</div>

<div class="row">

	{% if g.user.name != "Guest" %}
	
		{% include 'modal_sleeplog.html' %}
		
		{% if g.user.sleeplog is defined %}
		
			<div class="col-lg-12">
				<canvas id="sleepChart" ></canvas>

			</div>
			<br>
			<script>
				var ctx = $("#sleepChart").get(0).getContext("2d");
				
				// define the data for the chart
				var data = {
					labels: [{% for log in g.user.sleeplog %}"{{ log.sleep_start }}",{% endfor %}].reverse(),
					datasets: [
						{
							label: "Time In Bed",
							data: [{% for log in g.user.sleeplog %}"{{ log.total_time_in_minutes }}",{% endfor %}].reverse(),
							fillColor: "rgba(220,220,220,0.2)",
							strokeColor: "rgba(220,220,220,1)",
							pointColor: "rgba(220,220,220,1)",
							pointStrokeColor: "#fff",
							pointHighlightFill: "#fff",
							pointHighlightStroke: "rgba(220,220,220,1)",
						},
					]
				};
				var options = {
					///Boolean - Whether grid lines are shown across the chart
					scaleShowGridLines : true,
				
					//String - Colour of the grid lines
					scaleGridLineColor : "rgba(0,0,0,.05)",
				
					//Number - Width of the grid lines
					scaleGridLineWidth : 1,
					
					scaleFontColor: "rgba(235,235,235)",
					
					//Boolean - Whether the line is curved between points
					bezierCurve : true,
				
					//Number - Tension of the bezier curve between points
					bezierCurveTension : 0.4,
				
					//Boolean - Whether to show a dot for each point
					pointDot : true,
				
					//Number - Radius of each point dot in pixels
					pointDotRadius : 4,
				
					//Number - Pixel width of point dot stroke
					pointDotStrokeWidth : 1,
				
					//Number - amount extra to add to the radius to cater for hit detection outside the drawn point
					pointHitDetectionRadius : 20,
				
					//Boolean - Whether to show a stroke for datasets
					datasetStroke : true,
				
					//Number - Pixel width of dataset stroke
					datasetStrokeWidth : 2,
				
					//Boolean - Whether to fill the dataset with a colour
					datasetFill : true,

					// Boolean - whether or not the chart should be responsive and resize when the browser does.
					responsive: true,
				
					// Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
					maintainAspectRatio: false,
				};
				
				//apply width settings
				var theCanvas = $('canvas');
				newWidth = theCanvas.parent().width()
				theCanvas.prop({
					width: newWidth,
					height: 300,
				});
				var foodChart = new Chart(ctx).Line(data, options);
			
			</script>		

			<table class="table table-striped">
				<thead>
					<tr>
						<th class="col-md-2">Sleep Start</th>
						<th class="col-md-2">Sleep End</th>
						<th class="col-md-3">Time In Bed</th>
						<th class="col-md-2">Quality</th>
						<th class="col-md-2">Wake Up Mood</th>
						<th class="col-md-1 text-right">Edit</th>
					</tr>
				</thead>
				<tbody>
					{% for log in g.user.sleeplog %}
						<tr>
							<td>{{ log.sleep_start }}</td>
							<td>{{ log.sleep_end }}</td>
							<td>{{ log.total_time }}</td>
							<td>{{ log.quality }}</td>
							<td>{{ log.wake_up_mood }}</td>
							<td><span class="pull-right glyphicon glyphicon-pencil"></span></td>
						</tr>
					{% endfor %}
				</tbody>
		
		
			</table>
		
		{% else %}
			<p>No sleep logs have been entered yet!</p>
		{% endif %}
	
	{% else %}
		<p>Hey, you're not logged in!</p>
	{% endif %}

</div>

{% endblock %}
